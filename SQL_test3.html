<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quiz: Stored Procedures & Functions</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: 'Inter', sans-serif;
    }

    .quiz-option.selected {
      background-color: #3b82f6; /* bg-blue-500 */
      color: white;
      border-color: #2563eb; /* border-blue-700 */
    }

    .quiz-option:hover {
      background-color: #dbeafe; /* bg-blue-100 */
    }
    
    /* Ngăn chặn user bôi đen text */
    .noselect {
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      -khtml-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }
  </style>
</head>

<body class="bg-slate-100 flex items-center justify-center min-h-screen p-4">

  <div id="quiz-container" class="bg-white p-6 sm:p-8 rounded-2xl shadow-xl w-full max-w-3xl mx-auto">
    <div id="quiz-header" class="mb-6 border-b pb-4">
      <h1 class="text-2xl sm:text-3xl font-bold text-slate-800">Quiz: Stored Procedures & Functions (Test 3)</h1>
      <p id="progress-text" class="text-sm text-slate-500 mt-2">Câu 1 trên 20</p>
    </div>

    <div id="question-area">
      <h2 id="question-text" class="text-lg font-semibold text-slate-700 mb-5 leading-relaxed"></h2>
      <div id="options-container" class="space-y-3">
        </div>
    </div>

    <div id="navigation-buttons" class="mt-8 flex justify-between items-center">
      <button id="prev-btn"
        class="bg-slate-300 hover:bg-slate-400 text-slate-800 font-bold py-2 px-6 rounded-lg transition-colors duration-300 disabled:opacity-50 disabled:cursor-not-allowed">
        Câu Trước
      </button>
      <button id="next-btn"
        class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg transition-colors duration-300">
        Câu Tiếp
      </button>
      <button id="submit-btn"
        class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded-lg transition-colors duration-300 hidden">
        Nộp Bài
      </button>
    </div>
  </div>

  <div id="result-container" class="bg-white p-8 rounded-2xl shadow-xl w-full max-w-3xl mx-auto hidden">
    <h1 class="text-3xl font-bold text-slate-800 text-center">Kết Quả Bài Làm</h1>
    <div id="score-text" class="text-center text-2xl font-semibold my-6 bg-blue-100 text-blue-800 p-4 rounded-lg"></div>
    <div id="review-area" class="mt-6 space-y-4 max-h-[60vh] overflow-y-auto pr-2">
      </div>
    <div class="text-center mt-8">
      <button id="restart-btn"
        class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-8 rounded-lg transition-colors duration-300">
        Làm Lại
      </button>
    </div>
  </div>

  <script>
    // Dữ liệu 20 câu hỏi về Stored Procedures & Functions
    const quizData = [
      {
        question: "Hàm trong SQL Server có thể trả về:",
        options: ["Không trả về gì", "Một bảng (table-valued function)", "Một giá trị scalar", "Cả bảng và giá trị scalar đều đúng"],
        answer: "Cả bảng và giá trị scalar đều đúng"
      },
      {
        question: "Hàm scalar có thể dùng trong:",
        options: ["SELECT statement", "WHERE clause", "JOIN condition", "Tất cả các đáp án trên"],
        answer: "Tất cả các đáp án trên"
      },
      {
        question: "Lệnh nào sửa stored procedure hiện có?",
        options: ["UPDATE PROCEDURE proc_name ...", "MODIFY PROCEDURE proc_name ...", "ALTER PROCEDURE proc_name AS BEGIN ... END", "CREATE OR REPLACE PROCEDURE ..."],
        answer: "ALTER PROCEDURE proc_name AS BEGIN ... END"
      },
      {
        question: "Khi muốn bắt lỗi trong stored procedure, dùng:",
        options: ["TRY...CATCH", "IF...ELSE", "BEGIN...END", "SET ERROR"],
        answer: "TRY...CATCH"
      },
      {
        question: "Lệnh nào sửa thủ tục hiện có? (Câu hỏi tương tự)",
        options: ["UPDATE PROCEDURE ...", "CREATE OR REPLACE ...", "ALTER PROCEDURE proc_name AS BEGIN ... END", "MODIFY PROCEDURE ..."],
        answer: "ALTER PROCEDURE proc_name AS BEGIN ... END"
      },
      {
        question: "Lệnh nào thực thi stored procedure?",
        options: ["EXECUTE proc_name", "EXEC proc_name", "CALL proc_name", "A và B đúng (EXECUTE và EXEC)"],
        answer: "A và B đúng (EXECUTE và EXEC)"
      },
      {
        question: "Lệnh nào tạo stored procedure mới?",
        options: ["CREATE PROCEDURE proc_name RETURN ...", "CREATE FUNCTION ...", "CREATE PROC proc_name TABLE ...", "CREATE PROCEDURE proc_name AS BEGIN ... END"],
        answer: "CREATE PROCEDURE proc_name AS BEGIN ... END"
      },
      {
        question: "Lệnh nào sửa hàm hiện có?",
        options: ["MODIFY FUNCTION", "UPDATE FUNCTION", "ALTER FUNCTION func_name", "CREATE OR REPLACE FUNCTION"],
        answer: "ALTER FUNCTION func_name"
      },
      {
        question: "Stored Procedure có thể gọi stored procedure khác không?",
        options: ["Có, trực tiếp bằng EXEC", "Không", "Chỉ khi cùng database", "Chỉ khi cùng schema"],
        answer: "Có, trực tiếp bằng EXEC"
      },
      {
        question: "Stored Procedure có thể trả về giá trị thông qua:",
        options: ["RETURN", "SELECT bảng dữ liệu", "OUTPUT parameter", "Tất cả các đáp án trên"],
        answer: "Tất cả các đáp án trên"
      },
      {
        question: "RETURN trong function dùng để:",
        options: ["Trả về bảng kết quả", "Trả giá trị theo kiểu đã định (scalar hoặc table)", "Thay đổi bảng cơ sở", "Gọi procedure khác"],
        answer: "Trả giá trị theo kiểu đã định (scalar hoặc table)"
      },
      {
        question: "Lệnh nào gọi TVF (Table-Valued Function) trong SELECT?",
        options: ["SELECT * FROM dbo.FuncName(@param)", "RUN dbo.FuncName(@param)", "CALL dbo.FuncName(@param)", "EXEC dbo.FuncName"],
        answer: "SELECT * FROM dbo.FuncName(@param)"
      },
      {
        question: "Khi muốn hàm trả về bảng duy nhất từ SELECT, dùng:",
        options: ["Inline table-valued function", "Stored Procedure", "Multi-statement table-valued function", "Scalar function"],
        answer: "Inline table-valued function"
      },
      {
        question: "Stored Procedure có thể nhận tham số không?",
        options: ["Có", "Không", "Chỉ khi dùng OUTPUT", "Chỉ khi dùng default value"],
        answer: "Có"
      },
      {
        question: "Hàm (Function) không thể chứa:",
        options: ["SELECT statement", "Câu lệnh tính toán", "RETURN statement", "INSERT/UPDATE/DELETE vào bảng cơ sở"],
        answer: "INSERT/UPDATE/DELETE vào bảng cơ sở"
      },
      {
        question: "Inline table-valued function (TVF) khác multi-statement TVF ở điểm nào?",
        options: ["Multi-statement TVF có BEGIN...END và logic phức tạp", "Inline TVF chỉ có một SELECT duy nhất", "Inline TVF thường nhanh hơn", "Tất cả các đáp án trên"],
        answer: "Tất cả các đáp án trên"
      },
      {
        question: "Lệnh nào tạo hàm scalar?",
        options: ["CREATE FUNCTION ... AS BEGIN ... END", "CREATE PROC ... RETURNS ...", "CREATE FUNCTION func_name(@p INT) RETURNS INT AS BEGIN RETURN ... END", "CREATE PROCEDURE ..."],
        answer: "CREATE FUNCTION func_name(@p INT) RETURNS INT AS BEGIN RETURN ... END"
      },
      {
        question: "Hàm có thể nhận tham số không?",
        options: ["Có", "Không", "Chỉ scalar function", "Chỉ table-valued function"],
        answer: "Có"
      },
      {
        question: "Hàm trong SQL Server có thể thay đổi dữ liệu bảng (INSERT/UPDATE/DELETE) không?",
        options: ["Không", "Có"],
        answer: "Không"
      },
      {
        question: "OUTPUT parameter trong Stored Procedure dùng để:",
        options: ["Tự động commit transaction", "Trả về giá trị", "Chỉ hiển thị dữ liệu", "Định nghĩa default value"],
        answer: "Trả về giá trị"
      }
    ];

    let currentQuestionIndex = 0;
    let userAnswers = new Array(quizData.length).fill(null);

    const quizContainer = document.getElementById('quiz-container');
    const resultContainer = document.getElementById('result-container');
    const questionText = document.getElementById('question-text');
    const optionsContainer = document.getElementById('options-container');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const submitBtn = document.getElementById('submit-btn');
    const restartBtn = document.getElementById('restart-btn');
    const progressText = document.getElementById('progress-text');

    function loadQuestion() {
      const currentQuestion = quizData[currentQuestionIndex];
      questionText.textContent = `Câu ${currentQuestionIndex + 1}: ${currentQuestion.question}`;
      optionsContainer.innerHTML = '';

      currentQuestion.options.forEach((option, index) => {
        const optionId = `q${currentQuestionIndex}-option${index}`;
        const optionWrapper = document.createElement('div');
        optionWrapper.classList.add('quiz-option', 'p-4', 'border', 'rounded-lg', 'cursor-pointer', 'transition-colors', 'duration-200', 'noselect');

        const input = document.createElement('input');
        input.type = 'radio';
        input.id = optionId;
        input.name = `q${currentQuestionIndex}`;
        input.value = option;
        input.className = "hidden";

        const label = document.createElement('label');
        label.htmlFor = optionId;
        label.textContent = option;
        label.className = "block w-full cursor-pointer";

        optionWrapper.appendChild(input);
        optionWrapper.appendChild(label);
        optionsContainer.appendChild(optionWrapper);

        optionWrapper.addEventListener('click', () => handleOptionSelect(optionWrapper, input));
      });

      restoreAnswer();
      updateProgress();
      updateButtonVisibility();
    }

    function handleOptionSelect(wrapper, input) {
      const allOptions = optionsContainer.querySelectorAll('.quiz-option');
      allOptions.forEach(opt => {
        opt.classList.remove('selected');
        const inp = opt.querySelector('input');
        inp.checked = false;
      });

      wrapper.classList.add('selected');
      input.checked = true;
      saveAnswer();
    }

    function saveAnswer() {
      const selectedOption = document.querySelector(`input[name="q${currentQuestionIndex}"]:checked`);
      userAnswers[currentQuestionIndex] = selectedOption ? selectedOption.value : null;
    }

    function restoreAnswer() {
      const savedAnswer = userAnswers[currentQuestionIndex];
      if (savedAnswer === null) return;

      const inputs = document.querySelectorAll(`input[name="q${currentQuestionIndex}"]`);
      inputs.forEach(input => {
        if (input.value === savedAnswer) {
          input.checked = true;
          input.parentElement.classList.add('selected');
        }
      });
    }

    function updateProgress() {
      progressText.textContent = `Câu ${currentQuestionIndex + 1} trên ${quizData.length}`;
    }

    function updateButtonVisibility() {
      prevBtn.disabled = currentQuestionIndex === 0;
      if (currentQuestionIndex === quizData.length - 1) {
        nextBtn.classList.add('hidden');
        submitBtn.classList.remove('hidden');
      } else {
        nextBtn.classList.remove('hidden');
        submitBtn.classList.add('hidden');
      }
    }

    function showNextQuestion() {
      if (currentQuestionIndex < quizData.length - 1) {
        currentQuestionIndex++;
        loadQuestion();
      }
    }

    function showPrevQuestion() {
      if (currentQuestionIndex > 0) {
        currentQuestionIndex--;
        loadQuestion();
      }
    }

    function submitQuiz() {
      quizContainer.classList.add('hidden');
      resultContainer.classList.remove('hidden');
      showResults();
    }

    function showResults() {
      let score = 0;
      const reviewArea = document.getElementById('review-area');
      reviewArea.innerHTML = '';

      quizData.forEach((question, index) => {
        const userAnswer = userAnswers[index];
        let isCorrect = false;

        if (userAnswer === question.answer) {
          isCorrect = true;
          score++;
        }

        const reviewBlock = document.createElement('div');
        reviewBlock.className = `p-4 rounded-lg border ${isCorrect ? 'bg-green-50 border-green-300' : 'bg-red-50 border-red-300'}`;

        let answerHtml = `
            <p class="font-bold text-slate-800">${index + 1}. ${question.question}</p>
            <p class="mt-2 text-sm"><b>Bạn chọn:</b> ${userAnswer ? userAnswer : '<span class="text-red-500">Chưa trả lời</span>'}</p>
            <p class="mt-1 text-sm ${isCorrect ? 'text-green-700' : 'text-red-700'}"><b>Đáp án đúng:</b> ${question.answer}</p>
        `;
        reviewBlock.innerHTML = answerHtml;
        reviewArea.appendChild(reviewBlock);
      });

      const scoreText = document.getElementById('score-text');
      const percentage = Math.round((score / quizData.length) * 100);
      scoreText.innerHTML = `Bạn đã trả lời đúng <span class="font-bold text-2xl">${score}</span> / ${quizData.length} câu!<br><span class="text-sm text-blue-600">(${percentage}%)</span>`;
    }

    function restartQuiz() {
      currentQuestionIndex = 0;
      userAnswers.fill(null);
      resultContainer.classList.add('hidden');
      quizContainer.classList.remove('hidden');
      loadQuestion();
    }

    prevBtn.addEventListener('click', showPrevQuestion);
    nextBtn.addEventListener('click', showNextQuestion);
    submitBtn.addEventListener('click', submitQuiz);
    restartBtn.addEventListener('click', restartQuiz);

    window.onload = loadQuestion;
  </script>
</body>

</html>